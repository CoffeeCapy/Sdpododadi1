<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Foba Legends: Bang Bang - Touchscreen Mobile</title>
  <style>
    body { 
      margin: 0; padding: 0; 
      background: #000; 
      overflow: hidden; 
      font-family: Arial, sans-serif; 
      color: white; 
      touch-action: none; 
    }
    canvas { 
      display: block; 
      width: 100vw; 
      height: 100vh; 
      touch-action: none; 
    }
    #hud { 
      position: absolute; 
      bottom: 15px; 
      left: 15px; 
      display: flex; 
      flex-direction: column; 
      gap: 12px; 
      z-index: 20; 
    }
    .skill { 
      width: 85px; height: 85px; 
      background: rgba(30,30,60,0.85); 
      border: 4px solid #555; 
      border-radius: 50%; 
      display: flex; align-items: center; justify-content: center; 
      font-size: 32px; font-weight: bold; 
      position: relative; 
      touch-action: manipulation; 
      user-select: none; 
    }
    .skill.ready { border-color: #ffcc00; box-shadow: 0 0 18px #ffcc00; }
    .skill:active { transform: scale(0.92); background: rgba(50,50,80,0.9); }
    .cd { 
      position: absolute; inset: 0; 
      background: rgba(0,0,0,0.65); border-radius: 50%; 
      display: flex; align-items: center; justify-content: center; 
      font-size: 24px; font-weight: bold; 
    }
    #stats { 
      position: absolute; top: 12px; left: 12px; 
      background: rgba(0,0,0,0.7); padding: 12px 18px; 
      border-radius: 12px; font-size: 20px; z-index: 20; 
    }
    #joystick { 
      position: absolute; 
      bottom: 140px; right: 30px; 
      width: 140px; height: 140px; 
      background: rgba(255,255,255,0.08); 
      border-radius: 50%; 
      pointer-events: none; 
      z-index: 15; 
      display: none; 
    }
    #knob { 
      position: absolute; 
      width: 60px; height: 60px; 
      background: radial-gradient(#ffcc00, #cc9900); 
      border-radius: 50%; 
      top: 50%; left: 50%; 
      transform: translate(-50%, -50%); 
      box-shadow: 0 0 15px #ffcc00; 
    }
    @media (orientation: portrait) {
      #hud { gap: 10px; }
      .skill { width: 80px; height: 80px; font-size: 28px; }
      #joystick { bottom: 180px; right: 20px; width: 130px; height: 130px; }
    }
  </style>
</head>
<body>

<div id="stats">HP: <span id="hp">1000</span> | Gold: <span id="gold">0</span> | Kill: <span id="kills">0</span></div>

<div id="hud">
  <div class="skill ready" id="skillQ"><span>Q</span><div class="cd" id="cdQ"></div></div>
  <div class="skill" id="skillW"><span>W</span><div class="cd" id="cdW"></div></div>
  <div class="skill" id="skillE"><span>E</span><div class="cd" id="cdE"></div></div>
  <div class="skill" id="skillR"><span>R</span><div class="cd" id="cdR"></div></div>
</div>

<div id="joystick"><div id="knob"></div></div>

<canvas id="gameCanvas"></canvas>

<script>
// --- Kode utama ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
window.addEventListener('orientationchange', () => setTimeout(resize, 200));
resize();

// Hero & variabel lain (sama seperti sebelumnya, tapi skala dinamis)
let hero = {
  x: canvas.width * 0.25,
  y: canvas.height * 0.75,
  hp: 1000, maxHp: 1000,
  gold: 0,
  size: Math.max(24, canvas.width * 0.05),
  color: '#00d4ff',
  attackRange: Math.max(160, canvas.width * 0.18),
  attackDamage: 55,
  attackCooldown: 0,
  attackSpeed: 28,
  moveSpeed: Math.max(5, canvas.width * 0.008)
};

let projectiles = [], enemies = [], particles = [];
let kills = 0;

const skills = {
  Q: { cd: 0, maxCd: 90 },   // cepat untuk mobile
  W: { cd: 0, maxCd: 150 },
  E: { cd: 0, maxCd: 220 },
  R: { cd: 0, maxCd: 480 }
};

// Joystick vars
let joystick = { active: false, angle: 0, power: 0 };
const joyDiv = document.getElementById('joystick');
const knob = document.getElementById('knob');

// Touch events untuk joystick (kanan bawah)
canvas.addEventListener('touchstart', e => {
  e.preventDefault();
  for (let touch of e.changedTouches) {
    const x = touch.clientX;
    const y = touch.clientY;
    if (x > canvas.width * 0.6 && y > canvas.height * 0.6) { // area joystick
      joystick.active = true;
      joyDiv.style.display = 'block';
      updateJoystick(touch);
    }
  }
}, { passive: false });

canvas.addEventListener('touchmove', e => {
  e.preventDefault();
  if (joystick.active) {
    for (let touch of e.touches) {
      if (touch.clientX > canvas.width * 0.5) { // tetap di area kanan
        updateJoystick(touch);
      }
    }
  }
}, { passive: false });

canvas.addEventListener('touchend', e => {
  e.preventDefault();
  joystick.active = false;
  joyDiv.style.display = 'none';
  knob.style.transform = 'translate(-50%, -50%)';
}, { passive: false });

function updateJoystick(touch) {
  const rect = canvas.getBoundingClientRect();
  const centerX = rect.right - 70;
  const centerY = rect.bottom - 70;
  const dx = touch.clientX - centerX;
  const dy = touch.clientY - centerY;
  const dist = Math.hypot(dx, dy);
  joystick.power = Math.min(1, dist / 60);
  joystick.angle = Math.atan2(dy, dx);

  const moveDist = joystick.power * 45;
  knob.style.transform = `translate(-50%, -50%) translate(${Math.cos(joystick.angle) * moveDist}px, ${Math.sin(joystick.angle) * moveDist}px)`;
}

// Tap untuk skill atau attack (area kiri = skill auto, tapi tombol hud utama)
canvas.addEventListener('touchstart', e => {
  e.preventDefault();
  const touch = e.touches[0];
  const x = touch.clientX;
  // Tap kiri layar â†’ basic attack ke arah tap (jika bukan joystick area)
  if (x < canvas.width * 0.6) {
    const angle = Math.atan2(touch.clientY - hero.y, touch.clientX - hero.x);
    projectiles.push({
      x: hero.x, y: hero.y,
      vx: Math.cos(angle) * 10,
      vy: Math.sin(angle) * 10,
      damage: hero.attackDamage * 1.5,
      life: 50
    });
  }
}, { passive: false });

// Fungsi castSkill (dipanggil dari HTML ontouchstart tombol)
window.castSkill = function(skill) {
  if (skills[skill].cd > 0) return;
  skills[skill].cd = skills[skill].maxCd;

  if (skill === 'Q') {
    const angle = joystick.angle || Math.PI / 4; // default jika tidak ada joystick
    projectiles.push({ x: hero.x, y: hero.y, vx: Math.cos(angle)*14, vy: Math.sin(angle)*14, damage: 140, life: 70 });
  } else if (skill === 'W') {
    hero.x += Math.cos(joystick.angle || 0) * 160;
    hero.y += Math.sin(joystick.angle || 0) * 160;
  } // ... (E dan R sama seperti sebelumnya)

  // Efek visual sederhana
  particles.push({x: hero.x, y: hero.y, life: 20, color: '#ffcc00'});
};

// Update & draw logic (adaptasi dari versi sebelumnya)
function update() {
  // Gerak via joystick
  if (joystick.active && joystick.power > 0.1) {
    hero.x += Math.cos(joystick.angle) * hero.moveSpeed * joystick.power
