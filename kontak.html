<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Mario Mini Lengkap - Browser</title>
<style>
  body{margin:0;height:100vh;background:#000;display:flex;flex-direction:column;align-items:center;justify-content:center;font-family:Arial;}
  canvas{border:4px solid #444;box-shadow:0 0 30px #000;background:#87CEEB;}
  #info{color:#fff;font-size:18px;margin:10px;}
</style>
</head>
<body>

<div id="info">Skor: <span id="score">0</span> | Gunakan ←→ SPACE/↑ untuk lompat</div>
<canvas id="c" width="800" height="450"></canvas>

<script>
// === Mario Mini Lengkap (Single File HTML) ===

const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const scoreDisplay = document.getElementById('score');

const GRAVITY = 0.7;
const JUMP = -13;
const SPEED = 4.2;

let score = 0;
let keys = {};
let cameraX = 0;

let player = {
  x: 100, y: 200, w: 32, h: 48,
  vx: 0, vy: 0, onGround: false,
  big: false, fire: false, facing: 1
};

const platforms = [
  [0, 380, 3000, 70],     // tanah utama
  [400, 280, 140, 25],
  [700, 220, 180, 25],
  [1100, 300, 120, 25],
  [1500, 180, 200, 25],
  [2000, 260, 100, 25]
];

const coins = [
  {x:450, y:220, collected:false},
  {x:750, y:160, collected:false},
  {x:1150,y:240, collected:false},
  {x:1550,y:120, collected:false}
];

const enemies = [
  {x:600, y:340, w:32, h:32, vx:-1.2, alive:true}, // Goomba 1
  {x:900, y:340, w:32, h:32, vx:1.2, alive:true}   // Goomba 2
];

window.addEventListener('keydown', e=>keys[e.key.toLowerCase()]=true);
window.addEventListener('keyup',   e=>keys[e.key.toLowerCase()]=false);

function playJump() {
  const audio = new AudioContext();
  const osc = audio.createOscillator();
  osc.type = 'square';
  osc.frequency.setValueAtTime(600, audio.currentTime);
  osc.frequency.linearRampToValueAtTime(300, audio.currentTime + 0.1);
  osc.connect(audio.destination);
  osc.start();
  osc.stop(audio.currentTime + 0.12);
}

function update() {
  // Kontrol player
  player.vx = 0;
  if (keys['arrowleft'] || keys['a']) { player.vx = -SPEED; player.facing = -1; }
  if (keys['arrowright'] || keys['d']) { player.vx = SPEED; player.facing = 1; }
  if ((keys[' '] || keys['arrowup'] || keys['w']) && player.onGround) {
    player.vy = JUMP;
    player.onGround = false;
    playJump();
  }

  player.vy += GRAVITY;
  player.x += player.vx;
  player.y += player.vy;

  player.onGround = false;

  // Collision platform
  platforms.forEach(p => {
    let [px,py,pw,ph] = p;
    if (player.x + player.w > px && player.x < px+pw &&
        player.y + player.h > py && player.y + player.h - player.vy <= py && player.vy >= 0) {
      player.y = py - player.h;
      player.vy = 0;
      player.onGround = true;
    }
  });

  // Koin
  coins.forEach(c => {
    if (!c.collected && Math.abs(player.x - c.x) < 30 && Math.abs(player.y - c.y) < 40) {
      c.collected = true;
      score += 100;
      scoreDisplay.textContent = score;
      playJump(); // suara koin sederhana
    }
  });

  // Musuh
  enemies.forEach(e => {
    if (!e.alive) return;
    e.x += e.vx;

    // Balik arah kalau nabrak dinding (sederhana)
    if (e.x < 100 || e.x > 2500) e.vx *= -1;

    // Tabrakan player-musuh
    if (player.x + player.w > e.x && player.x < e.x + e.w &&
        player.y + player.h > e.y && player.y < e.y + e.h) {
      if (player.vy > 0 && player.y + player.h - player.vy <= e.y + 10) {
        // injak dari atas → musuh mati
        e.alive = false;
        player.vy = JUMP / 1.5;
        score += 200;
        scoreDisplay.textContent = score;
      } else {
        // kena samping → reset
        player.x = 100; player.y = 200; player.vy = 0;
        score = Math.max(0, score - 300);
        scoreDisplay.textContent = score;
      }
    }
  });

  // Kamera
  if (player.x > cameraX + canvas.width * 0.65) cameraX = player.x - canvas.width * 0.65;
  cameraX = Math.max(0, cameraX);
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Langit gradient
  let gr = ctx.createLinearGradient(0,0,0,canvas.height);
  gr.addColorStop(0,'#6dd5fa'); gr.addColorStop(1,'#87CEEB');
  ctx.fillStyle = gr; ctx.fillRect(0,0,canvas.width,canvas.height);

  // Tanah & platform
  ctx.fillStyle = '#8B4513';
  platforms.forEach(p => {
    ctx.fillRect(p[0]-cameraX, p[1], p[2], p[3]);
  });

  // Koin
  ctx.fillStyle = '#ffcc00';
  coins.forEach(c => {
    if (!c.collected) {
      ctx.beginPath();
      ctx.arc(c.x - cameraX, c.y, 12, 0, Math.PI*2);
      ctx.fill();
    }
  });

  // Musuh (Goomba coklat sederhana)
  enemies.forEach(e => {
    if (e.alive) {
      ctx.fillStyle = '#8B4513';
      ctx.fillRect(e.x - cameraX, e.y, e.w, e.h);
      ctx.fillStyle = '#000';
      ctx.fillRect(e.x - cameraX + 8, e.y + 8, 6, 6); // mata
      ctx.fillRect(e.x - cameraX + 18, e.y + 8, 6, 6);
    }
  });

  // Player (Mario)
  ctx.fillStyle = player.big ? '#e74c3c' : '#e67e22'; // merah / orange kecil
  ctx.fillRect(player.x - cameraX, player.y, player.w, player.h);

  // Topi
  ctx.fillStyle = '#c0392b';
  ctx.fillRect(player.x - cameraX + 4, player.y - 10, player.w - 8, 14);

  // Wajah
  ctx.fillStyle = '#f1c40f';
  ctx.fillRect(player.x - cameraX + 8, player.y + 10, 16, 16);

  // Mata
  ctx.fillStyle = '#000';
  ctx.fillRect(player.x - cameraX + (player.facing>0 ? 18:8), player.y + 14, 6, 8);
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
